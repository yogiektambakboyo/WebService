<?php class Admin_picklist_retur extends CI_Controller{	public function __construct() 	{		parent::__construct();		if (!$this->session->userdata('OperatorCode') || $this->session->userdata("OperatorRole") != '10/WHR/000' && $this->session->userdata("OperatorRole") != '10/WHR/999') {            redirect(base_url() . "index.php/login");        }		$this->load->model('admin_picklist_retur_model');	}		public function index()	{			$this->load->view('admin_picklist_retur/index');	}		public function entry()	{		$cabang 	= $this->input->post('cabang');		// $kodeCabang = $this->input->post('kodeCabang');				if ($cabang == false){			$cabang = '01/01';		}					if ($this->input->post('btnSimpan')){			if ($this->form_validateKode() == False){			}else {				$idKode = $this->input->post('idKodeNota');												$noPickList = $this->admin_picklist_retur_model->getNoPicklist($cabang);								// var_dump($this->input->post('noTransaksi'));				// var_dump($noPickList);								 foreach ($idKode as $kodeId){					$explode 					= explode('.',$kodeId);					$kodeNota[][$explode[2]] 	= $explode[0];					$gudang[]					= $explode[1];					// $ket[]		 	= $explode[2];				}								$jmlrecord=count($gudang);				$i=0;				$status=true;				while($i<$jmlrecord && $status==true)				{					$j=0;					while($j<$jmlrecord && $status==true)					{						if($gudang[$i]!=$gudang[$j])						{							$status=false;						}						$j++;					}					$i++;				}														if($status == true){									foreach ($kodeNota as $kode){												if(!empty($kode["Tolakan"])){							$this->admin_picklist_retur_model->setTolakandms($noPickList,$kode["Tolakan"]);							// var_dump($kode["Tolakan"]);						}else {							$this->admin_picklist_retur_model->setMasterJual($noPickList,$kode["Retur"]);						}					 }											$this->session->set_flashdata('success','No. Picklist '.$noPickList.' Berhasil Disimpan');					redirect('admin_picklist_retur/entry');				}else {					$this->session->set_flashdata('error','Gudang Harus Sama');					redirect('admin_picklist_retur/entry');				}						} 								}				if ($this->input->post('btnTampil')){			if ($this->form_validateCabang() == False){			}else{				$data['retur_picklist'] = $this->admin_picklist_retur_model->getPicklist_retur($cabang);			}					}						$data['retur_picklist'] = $this->admin_picklist_retur_model->getPicklist_retur($cabang);		$data['noPicklist']		= $this->admin_picklist_retur_model->getNoPicklist($cabang);		$data['ket']			= 'entry';		$data['kodeCabang']		= $cabang;		$data['cabang']		 	= $this->admin_picklist_retur_model->getCabang($this->session->userdata('HariCabang'));				$this->load->view('admin_picklist_retur/entry', $data);	}		function get_ajax_picklist() {        $cabang = $_POST['cabang'];		// var_dump($cabang);        $result = $this->admin_picklist_retur_model->getPicklist_retur($cabang);        $arr = array();		// var_dump($result);        foreach ($result as $row) {			$arr[] = array("NoPicklist" => $row['Kodenota'].'.'.$row['Kode'].'.'.$row['Jenis'], "Jenis" => $row['Jenis'], "Kodenota" => $row['Kodenota'], "Tgl" => $row["Tgl"], "Perusahaan" => $row['Perusahaan'], "Gudang" => $row['Gudang'], "SKU" => $row['SKU'], "Total" => $row['Total']);	        }        echo $_GET['jsoncallback'] . '(' . json_encode($arr) . ');';    }		public function list_edit()	{		$cabang	= $this->input->post('cabang');		if ($cabang == false){			$cabang = '01/01';		}		// var_dump($this->input->post('cabang'));		$data['cabang']	= $this->admin_picklist_retur_model->getCabang($this->session->userdata('HariCabang'));		$data['edit']	= $this->admin_picklist_retur_model->getListEdit($cabang);		$this->load->view('admin_picklist_retur/edit', $data);	}		public function edit($noPicklist)	{					$noPicklist = base64_decode($noPicklist);		$cabang 	= substr($noPicklist,0,5);		$dataEdit	= $this->admin_picklist_retur_model->getEdit($cabang,$noPicklist);			if ($this->input->post('btnSimpan')){			if ($this->form_validateKode() == False){			}else {							$idKode 	= $this->input->post('idKodeNota'); //yang dicentang				$noPickList = $this->input->post('kodeCabang'); // nopicklist																foreach ($idKode as $kodeId){					$explode 					= explode('.',$kodeId);					$kodeNota[][$explode[2]] 	= $explode[0];					$gudang[]					= $explode[1];					$jenis[]					= $explode[2];									}								$jmlrecord=count($gudang);				$i=0;				$status=true;				while($i<$jmlrecord && $status==true)				{					$j=0;					while($j<$jmlrecord && $status==true)					{						if($gudang[$i]!=$gudang[$j])						{							$status=false;						}						$j++;					}					$i++;				} 								if($status == true){												$this->admin_picklist_retur_model->setNullPickList($noPickList);									$this->admin_picklist_retur_model->setNullPickListTolakan($noPickList);													foreach ($kodeNota as $kode){											if(!empty($kode["Tolakan"])){														$this->admin_picklist_retur_model->setTolakandms($noPickList,$kode["Tolakan"]);						}else {							$this->admin_picklist_retur_model->setMasterJual($noPickList,$kode["Retur"]);						}					 }											$this->session->set_flashdata('success','Data Berhasil Disimpan');					redirect('admin_picklist_retur/list_edit');				}else {				// echo 'gudang beda';					$data['error'] = 'Gudang Harus Sama';				}										}		}				$data['retur_picklist'] = $dataEdit;		$data['ket'] 			= 'edit';		$data['cabang']			= $this->admin_picklist_retur_model->getCabangEditList($cabang, $this->session->userdata('HariCabang'));		$data['noPicklist']		= $noPicklist;		$data['kodeCabang']		= $noPicklist;		$this->load->view('admin_picklist_retur/entry', $data);			}			public function form_validateCabang()	{		$this->form_validation->set_rules('cabang', 'Cabang', 'required');				return $this->form_validation->run();	}		public function form_validateKode()	{		$this->form_validation->set_rules('idKodeNota[]', 'CheckBox', 'required');				return $this->form_validation->run();	}}?>